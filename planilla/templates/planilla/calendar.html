{% extends 'planilla/base.html' %}
{% load static %}
{% block title %}Guardia{% endblock title %}
{% block css_block %}
  <!-- fullCalendar -->
  <link rel="stylesheet" href="{% static 'planilla/fullcalendar.css' %}">

{% endblock %}
{% block content %}

<style>
.contenedor-dia {
  display: flex;
  flex-direction: column;
  align-items: center; /* Centrar todo horizontalmente */
  width: 100%;
}

.fecha {
  font-weight: bold;
  text-align: center;
  font-size: 14px;
}

.cuartelero {
  background-color: #ddd;
  text-align: center;
  font-size: 14px;
  font-weight: bold;
  padding: 5px;
  width: 100%; /* Ocupar toda la celda */
  box-sizing: border-box;
  border-radius: 4px;
}

.turnos {
  display: flex;
  justify-content: space-between;
  width: 100%;
  padding: 5px 0;
}

.turno-dia, .turno-noche {
  width: 48%;
  min-height: 40px;
  padding: 4px;
  box-sizing: border-box;
  text-align: center;
}

.turno-dia {
  background-color: rgba(243, 156, 18, 0.3);
}

.turno-noche {
  background-color: rgba(0, 115, 183, 0.3);
}

.evento {
  background-color: white;
  padding: 2px;
  border-radius: 3px;
  text-align: center;
  font-size: 12px;
}

</style>
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <div class="content-header">
            <div class="container-fluid">
            <div class="col-sm-6">
            </div><!-- /.col -->
            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- /.content-header -->

        <!-- Main content -->
        <div class="content">
    <!-- Main content -->
    <section class="content">
        <div class="container-fluid">
          <div class="row">
            <!-- /.col -->
            <div class="col-md-12">
              <div class="card card-primary">
                <div class="card-body p-0">
                  <!-- THE CALENDAR -->
                  <div id="calendar"></div>
                </div>
                <!-- /.card-body -->
              </div>
              <!-- /.card -->
            </div>
            <!-- /.col -->
          </div>
          <!-- /.row -->
        </div><!-- /.container-fluid -->
      </section>
      <!-- /.content --> 
            </div>
        </div>
    </div>

{% endblock %}
{% block js_block %}
<script src="{% static 'planilla/jquery-ui.js' %}"></script>
<!-- fullCalendar 2.2.5 -->
<script src="{% static 'planilla/moment.min.js' %}"></script>
<script src="{% static 'planilla/fullcalendar.js' %}"></script>

<script>
  $(function () {

    /* initialize the external events
     -----------------------------------------------------------------*/
    function ini_events(ele) {
      ele.each(function () {

        // create an Event Object (https://fullcalendar.io/docs/event-object)
        // it doesn't need to have a start or end
        var eventObject = {
          title: $.trim($(this).text()) // use the element's text as the event title
        }

        // store the Event Object in the DOM element so we can get to it later
        $(this).data('eventObject', eventObject)

        // make the event draggable using jQuery UI
        $(this).draggable({
          zIndex        : 1070,
          revert        : true, // will cause the event to go back to its
          revertDuration: 0  //  original position after the drag
        })

      })
    }

    ini_events($('#external-events div.external-event'))

    /* initialize the calendar
     -----------------------------------------------------------------*/
    //Date for the calendar events (dummy data)
    var date = new Date()
    var d    = date.getDate(),
        m    = date.getMonth(),
        y    = date.getFullYear()

    var Calendar = FullCalendar.Calendar;
    var Draggable = FullCalendar.Draggable;

    // var containerEl = document.getElementById('external-events');
    // var checkbox = document.getElementById('drop-remove');
    var calendarEl = document.getElementById('calendar');

    // initialize the external events
    // -----------------------------------------------------------------

    // new Draggable(containerEl, {
    //   itemSelector: '.external-event',
    //   eventData: function(eventEl) {
    //     return {
    //       title: eventEl.innerText,
    //       backgroundColor: window.getComputedStyle( eventEl ,null).getPropertyValue('background-color'),
    //       borderColor: window.getComputedStyle( eventEl ,null).getPropertyValue('background-color'),
    //       textColor: window.getComputedStyle( eventEl ,null).getPropertyValue('color'),
    //     };
    //   }
    // });

    let cuarteleros = {
    "2025-02-19": "David López",
    "2025-02-20": "Juan Pérez",
    "2025-02-21": "María Gómez"
    };

    var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',

      dayCellContent: function(arg) {
    let fecha = arg.date.getDate();
        let fechaISO = arg.date.toISOString().split("T")[0]; // Obtener formato YYYY-MM-DD
        let cuartelero = cuarteleros[fechaISO] || "No asignado"; // Asignar cuartelero según fecha

    return {
        html: `
          <div class="contenedor-dia">
            <div class="fecha">${fecha}</div>
            <div class="cuartelero">${cuartelero}</div>
            <div class="turnos">
              <div class="turno-dia" id="dia-${arg.date.toISOString()}"></div>
              <div class="turno-noche" id="noche-${arg.date.toISOString()}"></div>
            </div>
          </div>
        `
        };
    },
      eventContent: function(arg) {
        let turno = arg.event.extendedProps.turno;
        let targetDiv = document.getElementById(`${turno}-${arg.event.start.toISOString()}`);
        if (targetDiv) {
          targetDiv.innerHTML += `<div class="evento">${arg.event.title}</div>`;
          return { domNodes: [] }; // Evita que FullCalendar lo agregue normalmente
        }
        return { html: `<div class="evento">${arg.event.title}</div>` };
      },

      events: [
        {
          title: 'Morteyru',
          start: new Date(y, m, d),
          allDay: true,
          extendedProps: { turno: 'dia' }
        },
        {
          title: 'Leguizamon',
          start: new Date(y, m, d),
          allDay: true,
          extendedProps: { turno: 'noche' }
        },
        {
          title: 'Alves',
          start: new Date(y, m, d),
          allDay: true,
          extendedProps: { turno: 'noche' }
        }
      ]
    });


    calendar.render();
  })
</script>

{% endblock %}
